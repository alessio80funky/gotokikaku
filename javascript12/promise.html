<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
<style>
    body { font-family: sans-serif; max-width: 480px; margin: 20px auto; padding: 12px; }
    button{  padding: 10px auto; font-size: 16px; width: 100%; }
    pre{background: #000000; color: aliceblue; padding: 10px; border-radius: 5px;}
</style>
    <title>非同期処理</title>
</head>
<body>
    <h1>非同期処理</h1>
    <p>外部のuser.jsonを読み込んで一覧表示します。</p>
    <button id="thenBtn">Then()</button>
    <button id="asyncBtn">Async</button>
    <pre id="log"></pre>
<script>

    const $  = id => document.getElementById(id);
    const log = msg => $("log").textContent += msg + "\n"
    const clear = () => $("log").textContent = "";

     //then

     $("thenBtn").addEventListener("click", () => {
        clear();

        fetch("./users.json")
        .then( res => {
            if(!res.ok) throw new Error("ファイル見つかりません");
            return res.json();
        })
        .then(data => {
            log("✅データの読み込み成功")
            data.forEach((
                user => log(`ID:${user.id} ${user.name} ${user.age}`)
            ))
        })
        .catch(err => {
            log("❌データの読み込みに失敗しました" + err.message)
        })

     })

       //async/await

       $("asyncBtn").addEventListener("click", async () => {
            clear();

        try{
                const res = await fetch("./users.json");
                if(!res.ok)throw new Error("ファイル見つかりませんでした");
                const data = await res.json();
                log("✅データの読み込み成功");
                for(const user of data){
                    log(`ID:${user.id} ${user.name} ${user.age}`)
                }
            }catch(error){
                log("❌データの読み込みに失敗しました" + err.message)
            }

       })



</script>


</body>
</html>